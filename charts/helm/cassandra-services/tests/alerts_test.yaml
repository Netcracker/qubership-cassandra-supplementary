suite: Test Prometheus parameters
templates:
  - prometheus_alerts.yaml
tests:
  - it: should render Alert rules
    values:
      - ./values/prometheus_values.yaml
    asserts:
      - equal:
          path: spec.groups[0].rules[1].expr
          value: count(sum(kube_pod_status_phase{exported_namespace="NAMESPACE", exported_pod=~"cassandra[0-9].*"} * 0) by (exported_pod) or vector(0)) - 1 < 17
